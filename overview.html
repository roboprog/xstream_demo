<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="LibreOffice 3.5  (MacOSX)">
	<META NAME="CREATED" CONTENT="20130607;19182000">
	<META NAME="CHANGED" CONTENT="20130607;20421300">
	<STYLE TYPE="text/css">
	<!--
		@page { margin: 0.79in }
		* { background: #ffff99; }
		.text-body-indent , .text-body-indent U , .text-body-indent B { background: #4c1900; }
		P { margin-bottom: 0.08in; background: #ffff99; color: #663300 }
		H1 { margin-bottom: 0.08in; background: #ffff99; color: #663300 }
		H1.western { font-family: "Arial", sans-serif; font-size: 16pt }
		H1.cjk { font-family: "Arial Unicode MS"; font-size: 16pt }
		H1.ctl { font-size: 16pt }
		P.text-body-indent { margin-left: 0.2in; margin-bottom: 0.02in; background: #4c1900; color: #00dcff; font-family: "Courier New", monospace; font-size: 10pt }
		H2 { background: #ffff99; color: #663300 }
		H2.western { font-family: "Albany", sans-serif; font-size: 14pt; font-style: italic }
		H2.cjk { font-family: "HG Mincho Light J"; font-size: 14pt; font-style: italic }
		H2.ctl { font-family: "Arial Unicode MS"; font-size: 14pt; font-style: italic }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" TEXT="#663300" DIR="LTR">
<H1 CLASS="western">Overview: XStream Demo Examples</H1>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">This demo is to show some basic usage
of the “XStream” java library to serialize and deserialize Java
(or compatible JVM based language) objects.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">This library, available at
<A HREF="http://xstream.codehaus.org/download.html">http://xstream.codehaus.org/download.html</A>,
is very simple to use. There are only 3 calls you have to make:</P>
<UL>
	<LI><P>Create the encoder/decoder for serialization and
	deserialization.</P>
	<LI><P>Turn the object into a serialized string value</P>
	<LI><P>Turn a serialized string value back into an object</P>
</UL>
<P>Simple, no “<A HREF="http://discuss.joelonsoftware.com/?joel.3.219431.12">factory
factories</A>” required.</P>
<P><BR><BR>
</P>
<P>Also, this library works perfectly well with regular Java, but I
chose to make the examples in Groovy, just to make the code a little
shorter. Please, feel free to copy and expand the examples to full
length Java. (It won't change the constructor calls you have to make,
nor the encode/decode calls)</P>
<P><BR><BR>
</P>
<H2 CLASS="western">Example 1</H2>
<P>Assuming you have Groovy installed, have downloaded the jar(s),
and have the example code from
<A HREF="https://github.com/roboprog/xstream_demo">https://github.com/roboprog/xstream_demo</A>,
you should be able to create a serialized object by doing something
like the following:</P>
<P><BR><BR>
</P>
<DIV CLASS="text-body-indent">
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> <B>$GROOVY_HOME/bin/groovy
ex1.groovy W</B></P>
<P CLASS="text-body-indent">&lt;linked-hash-map&gt;</P>
<P CLASS="text-body-indent">&lt;entry&gt;</P>
<P CLASS="text-body-indent">&lt;string&gt;a&lt;/string&gt;</P>
<P CLASS="text-body-indent">&lt;int&gt;42&lt;/int&gt;</P>
<P CLASS="text-body-indent">&lt;/entry&gt;</P>
<P CLASS="text-body-indent">&lt;entry&gt;</P>
<P CLASS="text-body-indent">&lt;string&gt;b&lt;/string&gt;</P>
<P CLASS="text-body-indent">&lt;string&gt;random&lt;/string&gt;</P>
<P CLASS="text-body-indent">&lt;/entry&gt;</P>
<P CLASS="text-body-indent">&lt;entry&gt;</P>
<P CLASS="text-body-indent">&lt;string&gt;buddy&lt;/string&gt;</P>
<P CLASS="text-body-indent">&lt;linked-hash-map&gt;</P>
<P CLASS="text-body-indent">&lt;entry&gt;</P>
<P CLASS="text-body-indent">&lt;string&gt;a&lt;/string&gt;</P>
<P CLASS="text-body-indent">&lt;int&gt;86&lt;/int&gt;</P>
<P CLASS="text-body-indent">&lt;/entry&gt;</P>
<P CLASS="text-body-indent">&lt;entry&gt;</P>
<P CLASS="text-body-indent">&lt;string&gt;b&lt;/string&gt;</P>
<P CLASS="text-body-indent">&lt;string&gt;text&lt;/string&gt;</P>
<P CLASS="text-body-indent">&lt;/entry&gt;</P>
<P CLASS="text-body-indent">&lt;entry&gt;</P>
<P CLASS="text-body-indent">&lt;string&gt;buddy&lt;/string&gt;</P>
<P CLASS="text-body-indent">&lt;linked-hash-map
reference=&quot;../../../..&quot;/&gt;</P>
<P CLASS="text-body-indent">&lt;/entry&gt;</P>
<P CLASS="text-body-indent">&lt;/linked-hash-map&gt;</P>
<P CLASS="text-body-indent">&lt;/entry&gt;</P>
<P CLASS="text-body-indent">&lt;/linked-hash-map&gt;</P>
<P CLASS="text-body-indent"><BR><BR>
</P>
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> 
</P>
<P CLASS="text-body-indent"><BR><BR>
</P>
</DIV>
<P><BR><BR>
</P>
<P>Note that both demo programs take only a single command line
argument, either “W” to write out serialized data to stdout, or
“R” to read in serialized data from stdin.</P>
<P><BR><BR>
</P>
<P>One of the things you may notice in the first example program is
that the data structure has a cyclic reference – the two Map
objects reference each other. This is not a problem (at least for an
XML encoding), as the serializer detects the cycle and puts in an
XPath style link for the reference to the repeated object, rather
than trying to infinitely nest the values.</P>
<P><BR><BR>
</P>
<P>A Groovy language related note: the xstream packages are included
as part of the standard runtime, so you don't even need to include
anything extra on the classpath.</P>
<P><BR><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Now that we've seen some data being
written out, let's prove that we can read it back:</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<DIV CLASS="text-body-indent">
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> <B>$GROOVY_HOME/bin/groovy
ex1.groovy W &gt; ex1.txt</B></P>
<P CLASS="text-body-indent"><BR><BR>
</P>
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> <B>$GROOVY_HOME/bin/groovy
ex1.groovy R &lt; ex1.txt</B></P>
<P CLASS="text-body-indent">The maps, (mostly) unharmed: 
</P>
<P CLASS="text-body-indent">1) [a:42, b:random]; 
</P>
<P CLASS="text-body-indent">2) [a:86, b:text]</P>
<P CLASS="text-body-indent"><BR><BR>
</P>
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> 
</P>
<P CLASS="text-body-indent"><BR><BR>
</P>
</DIV>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">The demo code has to remove the
circular references before printing the resulting object(s), or
toString() will cause a stack overflow from infinite recursion.
Otherwise, those look like the values that the write mode of the demo
created.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western">Example 2</H2>
<P STYLE="margin-bottom: 0in">So far, this is pretty simple. However,
it's writing XML, and that's just too “90s” for us. That, and it
makes for very long output. For the next example, we are going to use
the jettison library to serialize our output as JSON, rather than
XML. 
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<DIV CLASS="text-body-indent">
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> <B>$GROOVY_HOME/bin/groovy -cp
./jettison-1.2.jar ex2.groovy W </B>
</P>
<P CLASS="text-body-indent">{&quot;emprec&quot;:{&quot;empId&quot;:&quot;E006&quot;,&quot;name&quot;:&quot;Joe
Blow&quot;,&quot;salary&quot;:80000}}</P>
<P CLASS="text-body-indent"><BR><BR>
</P>
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> 
</P>
<P CLASS="text-body-indent"><BR><BR>
</P>
</DIV>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Looks much more compact. Good.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">A couple new features used in this
example: if you have a class with a long name (including any package
prefix), you can set an alias (“emprec”, in this case) for the
class to shorten the output; the class used here has a non-default
constructor and final fields, but XStream is able to create and
initialize such objects anyway.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Seeing as how this looks so much like a
web service now, let's connect this “server” up to a “client”
(using a pipe) to test the read-back / deserialization:</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<DIV CLASS="text-body-indent">
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> <B>$GROOVY_HOME/bin/groovy -cp
./jettison-1.2.jar ex2.groovy W | $GROOVY_HOME/bin/groovy -cp
./jettison-1.2.jar ex2.groovy R</B></P>
<P CLASS="text-body-indent">The bean, unharmed: E006 - Joe Blow:
80000</P>
<P CLASS="text-body-indent"><BR><BR>
</P>
<P CLASS="text-body-indent"><U>rob@hyperion:~/proj/xstream_demo&gt;</U></P>
<P CLASS="text-body-indent"><U>$</U> 
</P>
</DIV>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Note:  I wished Groovy supported “#”
comments like a proper Unix scripting language, so I could put a
“shebang” line at the top of the scripts, but that's a problem
for another day.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western">Further Reading</H2>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Read the fine manual:</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><A HREF="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/XStream.html">
		http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/XStream.html</A></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><A HREF="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/json/JettisonMappedXmlDriver.html">
		http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/json/JettisonMappedXmlDriver.html</A></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">-Rob Anderson</P>
<P STYLE="margin-bottom: 0in">June 7, 2013</P>
</BODY>
</HTML>